<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Save events</title>
    <meta name="description" content="Template Description">

    <script src="Scripts/jquery-1.8.3.min.js"></script>
    <script src="Scripts/jquery-ui-1.9.2.min.js"></script>
    <script src="Scripts/ajaxWrapper.js"></script>
    <script src="Scripts/events.js"></script>
    <script src="Scripts/elements.js"></script>

    <link rel="stylesheet" type="text/css" href="Styles/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="Styles/Site.css" />

    <script type="text/javascript">
        $(function () {
            $("#startDate").datepicker({ dateFormat: "yy,mm,dd" });
            $("#endDate").datepicker({ dateFormat: "yy,mm,dd" });

            // Loading for edit
             getData("WebService/RavenDB.asmx/GetEvents",ShowAllEvents);
           
            $('#headline').blur(function () {
                var searchString = $('#headline').val();
                
                document.getElementById("eystein").src = "http://en.wikipedia.org/wiki/" + searchString;

                postXmlData("WebService/Wikipedia.asmx/Search", searchString, showWikiPicture);
            });

            $('#media').blur(function () {
                $("#imgShow").attr('src', $("#media").val());
            });

            

            $('#save').click(function() {
                var formData = $("form input, textarea"); 
                var json = SerializaFormEventJson(formData);

                postData("WebService/RavenDB.asmx/Save", json, AddEvent, ShowStatus);
            });
            $('#delete').click(function() {
                var id = $("#eventId").val();
                postData("WebService/RavenDB.asmx/Delete", queryOptions(id), DeleteEvent, ShowStatus);
            });

            $("#DropDownList").change(function() {
                var id = GetSelectedIdFromDropdown(this);
                if (id == "") {
                    ClearForm();
                    $("#delete").attr("disabled", "disabled");
                } else {
                    postData("WebService/RavenDB.asmx/GetEvent", queryOptions(id), populateForm);
                    $("#delete").removeAttr("disabled");
                }
            });

        });

        function DeleteEvent(response) {
            RemoveItemToDropDown("DropDownList", response.events.Id);
            ClearForm();
            ShowStatus(response);
        }

        function AddEvent(response) {
            if (response.title == "Saved") {
                AddItemToDropDown("DropDownList", response.events.headline, response.events.Id);
                ClearForm();
            }
            ShowStatus(response);
        }
        
        function ShowAllEvents(data) {
            var count = data.timeline.date.length;
            for (var i = 0; i < count; i++) {
                var name = data.timeline.date[i].headline;
                var id = data.timeline.date[i].Id;
                AddItemToDropDown("DropDownList", name, id);
            }
        }

        function showWikiPicture(data) {
            $("#imgShow").attr('src', data);
            $("#media").val(data);
        }

        function ShowStatus(json) {
            $("#output").text(json.title);
            $('#output').delay(3000).fadeOut('slow');
        }
    </script>

</head>

<body>

    <form>
        
      
        
        
        <div style="width: 400px;  float: left ">
           

              <h1>Timeline input</h1>

                    <select id="DropDownList">
                <option value="">[Create new]</option>
            </select>
        <br/><br/>
            
            <table>
                <tr>
                    <td>
                        <label for="headline">Headline</label></td>
                    <td>
                        <input type="text" id="headline" name="headline" maxlength="100" placeholder="Headline..." autofocus required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="text">Text</label></td>
                    <td>
                        
                        <textarea id="text" name="text" placeholder="Description..." required="required" ></textarea>

                        <!-- <input type="text" id="text" name="text" maxlength="255" placeholder="Text..." required /> -->
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="media">Media url</label></td>
                    <td>
                        <input type="url" id="media" name="media" maxlength="255" placeholder="Picture..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="credit">Credit</label></td>
                    <td>
                        <input type="text" id="credit" name="credit" maxlength="100" placeholder="Credit..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="category">Category</label></td>
                    <td>
                        <input type="text" id="category" name="category" maxlength="100" placeholder="Category..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="caption">Caption</label></td>
                    <td>
                        <input type="text" id="caption" name="caption" maxlength="100" placeholder="Caption..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="startDate">Start date</label></td>
                    <td>
                        <input type="date" id="startDate" name="startDate" required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="endDate">End date</label></td>
                    <td>
                        <input type="date" id="endDate" name="endDate" /></td>
                </tr>
            </table>
            <input type="hidden" id="eventId" />
            <button type="button" id="save">Save</button>
            <button type="button" id="delete" disabled="disabled">Delete</button>

            <div id="output">&nbsp;</div>
                        
<img src="#" id="imgShow" width="320" height="400" alt="Image from Wikipedia" />
        </div>
        &nbsp;

        <iframe id="eystein" width="900" height="800" frameborder="0" style="margin-left: 20px; float: left"></iframe>


    </form>
</body>
</html>

