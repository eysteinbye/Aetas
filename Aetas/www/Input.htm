<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Save events</title>
    <meta name="description" content="Template Description">

    <script src="Scripts/jquery-1.8.3.min.js"></script>
    <script src="Scripts/jquery-ui-1.9.2.min.js"></script>
    <script src="Scripts/ajaxWrapper.js"></script>
    <script src="Scripts/events.js"></script>
    <script src="Scripts/elements.js"></script>

    <link rel="stylesheet" type="text/css" href="Styles/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="Styles/Site.css" />

    <script type="text/javascript">
        $(function () {
            $("#startDate").datepicker({ dateFormat: "yy,mm,dd" });
            $("#endDate").datepicker({ dateFormat: "yy,mm,dd" });
            // Loading for edit
             getData("WebService/RavenDB.asmx/GetEvents",ShowAllEvents);
           

            $('#headline').blur(function () {
                var searchString = $('#headline').val();
                postXmlData("WebService/Wikipedia.asmx/Search", searchString, showWikiPicture);
            });

            $('#save').click(function() {
                var formData = $("form input");
                var json = SerializaFormEventJson(formData);
                postData("WebService/RavenDB.asmx/Save", json, writeDebug);
            });

        });

        function ShowAllEvents(data) {
            var count = data.timeline.date.length;
            for (var i = 0; i < count; i++) {
                var name = data.timeline.date[i].headline;
                var id = data.timeline.date[i].Id;
                AddItemToDropDown("DropDownList", name, id);
            }
        }

        function ShowEvent(ddl) {
            var id = GetSelectedIdFromDropdown(ddl);
            postData("WebService/RavenDB.asmx/GetEvent", queryOptions(id), populateForm);
        }

        function showWikiPicture(data) {
            $("#imgShow").attr('src', data);
            $("#media").val(data);
        }

        function writeDebug(json) {
            $("#output").text(json);
        }
    </script>

</head>

<body>

    <form>
        <div style="width: 800px">
            
            <select id="DropDownList" onchange="ShowEvent(this)"></select>

            <img src="#" id="imgShow" width="320" style="float: right" alt="Image from Wikipedia" />

            <table>
                <tr>
                    <td>
                        <label for="headline">Headline</label></td>
                    <td>
                        <input type="text" id="headline" name="headline" maxlength="100" style="width: 300px" placeholder="Headline..." autofocus required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="text">Text</label></td>
                    <td>
                        <input type="text" id="text" name="text" maxlength="255" style="width: 300px" placeholder="Text..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="media">Media url</label></td>
                    <td>
                        <input type="url" id="media" name="media" maxlength="255" style="width: 300px" placeholder="Picture..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="credit">Credit</label></td>
                    <td>
                        <input type="text" id="credit" name="credit" maxlength="100" style="width: 300px" placeholder="Credit..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="category">Category</label></td>
                    <td>
                        <input type="text" id="category" name="category" maxlength="100" style="width: 300px" placeholder="Category..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="caption">Caption</label></td>
                    <td>
                        <input type="text" id="caption" name="caption" maxlength="100" style="width: 300px" placeholder="Caption..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="startDate">Start date</label></td>
                    <td>
                        <input type="text" id="startDate" name="startDate" required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="endDate">End date</label></td>
                    <td>
                        <input type="text" id="endDate" name="endDate" /></td>
                </tr>
            </table>
            <input type="hidden" id="eventId" />
            <button type="button" id="save">Save</button>

            <div id="output"></div>




        </div>
    </form>
</body>
</html>

