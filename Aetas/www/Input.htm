<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Save events</title>
    <meta name="description" content="Template Description">

    <script src="Scripts/jquery-1.8.3.min.js"></script>
    <script src="Scripts/jquery-ui-1.9.2.min.js"></script>
    <script src="Scripts/ajaxWrapper.js"></script>
    <link rel="stylesheet" type="text/css" href="Styles/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="Styles/Site.css" />

    <!--
        
        Lag edit av eksisterene
	        Hva med events with no end?
            Hva med ca. date
            Upload picture
            Ha som egen siden, men med loggin
	    -->

    <script type="text/javascript">
        $(function () {
            $("#startDate").datepicker({ dateFormat: "yy,mm,dd" });
            $("#endDate").datepicker({ dateFormat: "yy,mm,dd" });
            // Loading for edit
            // postData("WebService/RavenDB.asmx/GetEvent", queryOptions(), populateForm);

            $('#headline').blur(function () {
                var searchString = $('#headline').val();
                postXmlData("WebService/Wikipedia.asmx/Search", searchString, showWikiPicture);
            });

            $('#save').click(function() {
                var formData = $("form input");
                var json = makeEventJson(formData);
                postData("WebService/RavenDB.asmx/Save", json, writeDebug);
            });

        });

        function showWikiPicture(data) {
            $("#imgShow").attr('src', data);
            $("#media").val(data);
        }

        function makeEventJson(formData) {
            // bruke id og ikke index?
            var jsonObj =
            {
                "headline": formData[0].value,
                "text": formData[1].value,
                "asset": {
                    "media": formData[2].value,
                    "credit": formData[3].value,
                    "caption": formData[4].value
                },
                "startDate": formData[5].value,
                "endDate": formData[6].value
            };
            return jsonObj;
        }

        function writeDebug(json) {
            $("#output").text(json);
        }

        /* 
              // The ID of the one to edit (get back)
              function queryOptions() {
                  var myOptions =
                          {
                              "eventId": "1"
                          };
                  return myOptions;
              }
              */
    </script>

</head>

<body>

    <form>
        <div style="width: 800px">

            <img src="#" id="imgShow" width="320" style="float: right" alt="Image from Wikipedia" />

            <table>
                <tr>
                    <td>
                        <label for="headline">Headline</label></td>
                    <td>
                        <input type="text" id="headline" name="headline" maxlength="100" style="width: 300px" placeholder="Headline..." autofocus required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="text">Text</label></td>
                    <td>
                        <input type="text" id="text" name="text" maxlength="255" style="width: 300px" placeholder="Text..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="media">Media url</label></td>
                    <td>
                        <input type="url" id="media" name="media" maxlength="255" style="width: 300px" placeholder="Picture..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="credit">Credit</label></td>
                    <td>
                        <input type="text" id="credit" name="credit" maxlength="100" style="width: 300px" placeholder="Credit..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="caption">Caption</label></td>
                    <td>
                        <input type="text" id="caption" name="caption" maxlength="100" style="width: 300px" placeholder="Caption..." required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="startDate">Start date</label></td>
                    <td>
                        <input type="text" id="startDate" name="startDate" required /></td>
                </tr>
                <tr>
                    <td>
                        <label for="endDate">End date</label></td>
                    <td>
                        <input type="text" id="endDate" name="endDate" /></td>
                </tr>
            </table>

            <button type="button" id="save">Save</button>

            <div id="output"></div>




        </div>
    </form>
</body>
</html>

